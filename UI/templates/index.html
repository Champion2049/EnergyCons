<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-D Haar LWT Uploader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 600px; margin-top: 5rem; }
        .card { padding: 2rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card shadow-sm">
            <h1 class="mb-4 text-center">N-Dimensional Haar Wavelet Transform</h1>
            <p class="text-muted text-center mb-4">Upload a CSV file to get decomposition coefficients for 1D or ND data.</p>
            
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="alert alert-{{ 'danger' if category == 'error' else category }}">{{ message }}</div>
                {% endfor %}
              {% endif %}
            {% endwith %}

            <form method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label class="form-label"><b>Data Dimension</b></label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="data_dimension" id="dim1d" value="1d" checked>
                        <label class="form-check-label" for="dim1d">1D (Single column from CSV)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="data_dimension" id="dim2d" value="2d">
                        <label class="form-check-label" for="dim2d">ND (All numeric columns from CSV)</label>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="file" class="form-label"><b>CSV Dataset File</b></label>
                    <input type="file" class="form-control" name="file" id="file" required>
                </div>

                <div class="mb-3" id="columnNameDiv">
                    <label for="column_name" class="form-label"><b>Column Name (for 1D only)</b></label>
                    <input type="text" class="form-control" name="column_name" id="column_name" placeholder="e.g., Speed">
                </div>

                <div class="mb-3">
                    <label for="levels" class="form-label"><b>Decomposition Levels</b></label>
                    <input type="number" class="form-control" name="levels" id="levels" value="3" min="1" required>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">Get Coefficients</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // This script ensures the "Column Name" input is only visible for 1D mode.
        function toggleColumnInput() {
            const dim = document.querySelector('input[name="data_dimension"]:checked').value;
            const columnInputDiv = document.getElementById('columnNameDiv');
            const columnInput = document.getElementById('column_name');

            if (dim === '1d') {
                columnInputDiv.style.display = 'block';
                columnInput.required = true;
            } else {
                columnInputDiv.style.display = 'none';
                columnInput.required = false;
            }
        }

        // Add event listeners to the radio buttons to trigger the function on change.
        document.addEventListener('DOMContentLoaded', function() {
            const radios = document.querySelectorAll('input[name="data_dimension"]');
            radios.forEach(radio => radio.addEventListener('change', toggleColumnInput));
            
            // Run on page load to set the correct initial state.
            toggleColumnInput(); 
        });
    </script>
</body>
</html>
